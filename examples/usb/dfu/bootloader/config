%set OUTPUT_NAME dfu_bootloader
%append MODULES $(OUTPUT_NAME):$(CONFIGPATH)

CONFIG_LICENSE_APP_BSD
CONFIG_APP_START

%include scripts/options.build
%include arch/arch.build

CONFIG_DRIVER_USBDEV_DFU_CLASS
CONFIG_DRIVER_USBDEV_DFU_DFU
CONFIG_DRIVER_MEM_PARTITION
CONFIG_USBDEV_DEFAULT_DEVICE_INFO undefined
CONFIG_LIBC_STRING_SMALL

# Reserve 64K for bootloader
CONFIG_LOAD_ROM_RO_SIZE 65536

%subsection efm32-stk3600
  CONFIG_DRIVER_EFM32_MSC
  CONFIG_DRIVER_USB_SYNOPSYS_EFM32

  CONFIG_DRIVER_EFM32_LEUART_PRINTK undefined
  CONFIG_DRIVER_EFM32_LEUART undefined
  CONFIG_DRIVER_EFM32_USART undefined
  CONFIG_DRIVER_EFM32_TIMER undefined
  CONFIG_DRIVER_EFM32_PWM undefined
  CONFIG_DRIVER_EFM32_RTC undefined
  CONFIG_DRIVER_EFM32_AES undefined
  CONFIG_DRIVER_EFM32_DMA undefined
  CONFIG_DRIVER_EFM32_I2C undefined
  CONFIG_DRIVER_EFM32_HWRAND undefined
  CONFIG_DRIVER_EFM32_BITBANG undefined
  CONFIG_CPU_ARM32M_CLOCK undefined
  CONFIG_DEVICE_CLOCK_THROTTLE undefined
  CONFIG_CPU_ARM32M_TIMER_DWTCYC undefined
  CONFIG_CPU_ARM32M_TIMER_SYSTICK undefined
  CONFIG_DEVICE_CLOCK_VARFREQ undefined
  CONFIG_DRIVER_EFM32_GPIO_UNTIL undefined
  CONFIG_DRIVER_EFM32_RECMU_NAMES undefined
  CONFIG_DRIVER_EFM32_RECMU_SLEEPDEEP undefined
  CONFIG_LIBC_FORMATTER undefined
%end

%subsection nrf5x-bv1prodtester
  CONFIG_DRIVER_NRF52_USBD
  CONFIG_DRIVER_NRF5X_CLOCK
%end

%subsection printk-*
  %subsection printk-rtt
    CONFIG_DRIVER_RTT_PRINTK
  %end

  %subsection printk-uart
    CONFIG_DRIVER_NRF5X_PRINTK
    CONFIG_DRIVER_EFM32_USART_PRINTK
  %else
    CONFIG_DRIVER_EFM32_USART_PRINTK undefined
  %end

#  CONFIG_MUTEK_PRINTK_COMPILE_EXPR level >= LOGK_LEVEL_NORMAL || id == 'dfus' || id == 'usbd'
#  CONFIG_MUTEK_PRINTK_RUNTIME_EXPR level >= LOGK_LEVEL_NORMAL || id == 'dfus' || id == 'usbd'
%else
  CONFIG_DRIVER_EFM32_USART_PRINTK undefined
  CONFIG_MUTEK_PRINTK undefined
%end

